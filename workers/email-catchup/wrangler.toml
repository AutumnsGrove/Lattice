# Email Catch-up Worker
#
# Weekly cron job that handles edge cases in email delivery:
# - Finds users who missed scheduled emails
# - Syncs unsubscribes from Resend back to D1
# - Marks completed sequences
#
# Deploy: wrangler deploy
# Logs: wrangler tail
# Test manually: wrangler dev --test-scheduled

name = "grove-email-catchup"
main = "worker.ts"
compatibility_date = "2024-01-01"

# Weekly on Sunday at 10:00 AM UTC
[triggers]
crons = ["0 10 * * 0"]

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "grove-engine-db"
database_id = "a6394da2-b7a6-48ce-b7fe-b1eb3e730e68"

# Service binding for Worker-to-Worker communication
[[services]]
binding = "EMAIL_RENDER"
service = "grove-email-render"

# Environment variables (URL kept as fallback for local dev)
[vars]
EMAIL_RENDER_URL = "https://grove-email-render.m7jv4v7npb.workers.dev"

# Secrets (set via wrangler secret put)
# - RESEND_API_KEY: Resend API key for sending emails
