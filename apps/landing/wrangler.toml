name = "grove-landing"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Worker entry point (SvelteKit adapter-cloudflare output)
main = ".svelte-kit/cloudflare/_worker.js"

# Static assets served alongside the Worker
[assets]
directory = ".svelte-kit/cloudflare"
binding = "ASSETS"

# Environment variables for local development
[vars]
CDN_URL = "http://localhost:5173/cdn"
ZEPHYR_URL = "https://grove-zephyr.m7jv4v7npb.workers.dev"
# Turnstile (Shade) - human verification
TURNSTILE_SITE_KEY = "0x4AAAAAACI9p49O_VFDy3WA"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "grove-engine-db"
database_id = "a6394da2-b7a6-48ce-b7fe-b1eb3e730e68"

[[d1_databases]]
binding = "OBS_DB"
database_name = "grove-observability-db"
database_id = "59e70f9e-8f9c-4021-96e5-1e130e753766"

[[d1_databases]]
binding = "CURIO_DB"
database_name = "grove-curios-db"
database_id = "b03756ad-30d7-427a-9a1b-ec2f6478fcbd"

# GroveAuth Service Binding (Heartwood - fast session validation)
[[services]]
binding = "AUTH"
service = "groveauth"

# Zephyr Service Binding (email gateway - direct internal routing)
[[services]]
binding = "ZEPHYR"
service = "grove-zephyr"

# Vista Collector Service Binding (manual collection trigger)
[[services]]
binding = "VISTA_COLLECTOR"
service = "grove-vista-collector"

# R2 Storage binding
[[r2_buckets]]
binding = "CDN_BUCKET"
bucket_name = "grove-cdn"

# KV for rate limiting and caching (shared with engine)
[[kv_namespaces]]
binding = "CACHE"
id = "514e91e81cc44d128a82ec6f668303e4"

# KV for feature flags caching (alias for CACHE, used by greenhouse admin)
# Named CACHE_KV to match engine package conventions
[[kv_namespaces]]
binding = "CACHE_KV"
id = "514e91e81cc44d128a82ec6f668303e4"

# Secrets (set via `wrangler secret put` or `gw secret apply`):
# - ZEPHYR_API_KEY - Shared secret for authenticating with Zephyr email worker
# - TURNSTILE_SECRET_KEY - Cloudflare Turnstile secret (Shade)
# - UNSUBSCRIBE_SECRET - HMAC secret for email unsubscribe tokens
#
# Production env vars (set via `wrangler secret put` for sensitive values):
# - ADMIN_EMAILS
# - CDN_URL = https://cdn.grove.place
