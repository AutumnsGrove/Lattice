name: Deploy Landing

on:
  push:
    branches: [main]
    paths:
      - "apps/landing/**"
      - "libs/engine/**"
      - "docs/help-center/**"
      - "docs/legal/**"
      - "docs/specs/**"
  workflow_run:
    workflows: ["Auto-tag on Version Bump"]
    types: [completed]
  workflow_dispatch:

permissions:
  contents: read
  deployments: write

jobs:
  deploy:
    # Skip if triggered by failed workflow_run
    if: ${{ github.event_name != 'workflow_run' || github.event.workflow_run.conclusion == 'success' }}
    uses: ./.github/workflows/_deploy-worker.yml
    with:
      worker-dir: apps/landing
      needs-engine: true
      run-build: true
      run-tests: true
      typecheck-command: pnpm check
      run-migrations: true
      migration-db: grove-engine-db
      checkout-ref: main
    secrets: inherit
