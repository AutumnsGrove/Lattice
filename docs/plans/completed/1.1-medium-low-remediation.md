# Grove 1.1 Medium & Low Priority Remediation Plan

**Created**: January 8, 2026
**Priority**: P2 (Medium) + P3 (Low)
**Total Issues**: 52
**Target**: Post-1.0 cleanup sprint

---

## Overview

These issues do not block 1.0 launch but should be addressed in the first post-launch maintenance sprint. They improve code quality, consistency, and developer experience.

---

## Agent 1: Content Quality Fixes

**Priority**: P2/P3
**Issues**: 8

### Medium (4)

| File | Lines | Issue |
|------|-------|-------|
| `landing/src/lib/utils/markdown-parser.ts` | 23-59 | No sanitization (trusted content, but add warning comments) |
| `packages/engine/src/lib/utils/sanitize.ts` | 241, 48 | Inconsistent allowed tags between sanitizers |
| Multiple components | Various | No systematic `rel="noopener noreferrer"` enforcement |
| `packages/engine/src/lib/utils/sanitize.ts` | 64, 279 | Style forbidden but class allowed without restriction |

### Low (4)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/utils/markdown.ts` | 392-394 | Gutter markdown parsed synchronously without caching |
| `packages/engine/src/lib/utils/markdown.ts` | 47-68 | GutterItem type has permissive `[key: string]: unknown` |
| Multiple Svelte components | Various | 559 dynamic class bindings - audit for user input safety |
| Documentation | N/A | Add CSP headers for defense-in-depth |

---

## Agent 2: Storage Quality Fixes

**Priority**: P2/P3
**Issues**: 7

### Medium (5)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/routes/api/images/upload/+server.ts` | 6-18 | Incomplete WebP magic byte validation |
| `packages/engine/src/lib/server/services/storage.ts` | 339-345 | Cleanup failure logged but swallowed |
| `packages/engine/src/routes/api/images/upload/+server.ts` | 119-147 | Filename sanitization happens client-side only |
| `packages/engine/src/lib/utils/csrf.js` | 69-71 | Blanket CSRF exception for *.grove.place |
| `packages/engine/src/lib/server/services/storage.ts` | 382-383 | Default content-type overly permissive |

### Low (2)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/server/services/storage.ts` | 184-186 | No error handling for crypto.randomUUID() |
| `packages/engine/src/routes/api/images/upload/+server.ts` | 167 | Hardcoded CDN domain |

---

## Agent 3: Authentication Quality Fixes

**Priority**: P2/P3
**Issues**: 5

### Medium (4)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/hooks.server.ts` | 218-255 | Sequential SessionDO/JWT validation causes latency |
| `domains/src/hooks.server.ts` | 155-202 | Silent token refresh without user awareness |
| `plant/src/routes/+layout.server.ts` | 6, 48-51 | Missing security event logging for invalid sessions |
| `packages/engine/src/lib/groveauth/client.ts` | 254, 298, 368 | Missing runtime validation for API responses |

### Low (1)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/auth/session.js` | 48 | Case-insensitive email comparison without storage normalization |

---

## Agent 4: Core Infrastructure Quality Fixes

**Priority**: P2/P3
**Issues**: 6

### Medium (4)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/groveauth/client.ts` | 254, 298, 345, 388, 496, 534, 566, 607, 649, 691 | Multiple `as any` type assertions |
| `packages/engine/src/lib/server/services/cache.ts` | 372-378 | Rate limiting race condition documented but not fixed |
| `packages/engine/src/hooks.server.ts` | 206-209, 252-254, 285-287 | Error handling swallows exceptions |
| `packages/engine/src/hooks.server.ts` | 180 | Subdomain not validated before DB query |

### Low (2)

| File | Lines | Issue |
|------|-------|-------|
| `packages/grove-router/src/index.ts` | 191-193 | Proxy errors don't include request ID |
| `packages/engine/src/hooks.server.ts` | 16-20, 296-299 | Duplicate cookie parsing logic |

---

## Agent 5: Social & Federation Quality Fixes

**Priority**: P2/P3
**Issues**: 4

### Medium (2)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/utils/sanitize.ts` | 34-37 | SSR sanitization disabled (covered in P0) |
| `packages/engine/src/routes/api/feed/+server.ts` | 33 | Manual XML escaping instead of tested library |

### Low (2)

| File | Lines | Issue |
|------|-------|-------|
| `docs/help-center/articles/opting-into-the-feed.md` | 1-74 | Documentation for unimplemented features |
| `docs/help-center/articles/reactions-and-voting.md` | 1-96 | Documentation for unimplemented features |

---

## Agent 6: Analytics Quality Fixes

**Priority**: P2/P3
**Issues**: 5

### Medium (4)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/routes/api/stats/+server.ts` | 90, 128 | Errors not captured for monitoring |
| `packages/engine/src/lib/server/logger.ts` | 78-111 | In-memory log buffers lost on restart |
| `packages/engine/src/routes/api/verify/turnstile/+server.ts` | 44-46, 56 | IP data in console.warn output |
| N/A | N/A | No Durable Objects for analytics batching |

### Low (1)

| File | Lines | Issue |
|------|-------|-------|
| `landing/workers/onboarding-emails/worker.ts` | 351-480 | Email worker errors not captured for alerting |

---

## Agent 7: UI Component Quality Fixes

**Priority**: P2/P3
**Issues**: 12

### Medium (8)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/components/quota/UpgradePrompt.svelte` | 176-177 | Backdrop without keyboard escape |
| `packages/engine/src/lib/components/custom/GutterItem.svelte` | 34-35 | Non-interactive element with handlers |
| `packages/engine/src/lib/ui/components/ui/GlassCarousel.svelte` | 320-321 | Focusable without navigation docs |
| `packages/engine/src/lib/ui/components/ui/GlassOverlay.svelte` | 83-84 | Same as GlassCarousel |
| `packages/engine/src/lib/ui/components/forms/TurnstileWidget.svelte` | 103 | Container lacks ARIA label |
| `packages/engine/src/lib/ui/components/content/PlanCard.svelte` | 72-77 | Disabled button lacks explanation |
| Multiple icon-only buttons | Various | Using title instead of aria-label |
| Multiple components | Various | Suppressed a11y warnings need review |

### Low (4)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/src/lib/ui/components/primitives/input/input.svelte` | 1-46 | No built-in label support |
| `packages/engine/src/lib/ui/components/primitives/textarea/textarea.svelte` | 1-24 | No built-in label support |
| `packages/engine/src/lib/ui/components/chrome/Header.svelte` | 57-64 | Logo aria-label could be more descriptive |
| Documentation | N/A | Create component accessibility guidelines |

---

## Agent 8: Durable Objects Quality Fixes

**Priority**: P2/P3
**Issues**: 3

### Medium (1)

| Issue | Description |
|-------|-------------|
| Roadmap priority | SessionDO marked HIGHEST PRIORITY but not implemented |

### Low (2)

| File | Lines | Issue |
|------|-------|-------|
| `docs/rings-analytics-do-integration.md` | 1-5 | Archived doc should move to `_archived/` |
| Multiple docs | N/A | Duplicate DO pattern content across files |

---

## Agent 9: Configuration Quality Fixes

**Priority**: P2/P3
**Issues**: 7

### Medium (5)

| File | Lines | Issue |
|------|-------|-------|
| Multiple `wrangler.toml` | 2 | Inconsistent compatibility_date |
| Multiple `package.json` | Various | @cloudflare/workers-types version drift |
| `packages/engine/package.json` | 212 | @sveltejs/kit version inconsistency |
| `packages/engine/package.json` | 229 | Svelte version inconsistency |
| Multiple `wrangler.toml` | Various | Hardcoded database ID |

### Low (2)

| File | Lines | Issue |
|------|-------|-------|
| `packages/engine/package.json` | 239 | Local file dependency outside monorepo |
| `packages/engine/wrangler.toml` | 4-10 | Template instructions in production config |

---

## Execution Strategy

### Sprint 1.1a (Week 1)
- Agent 1: Content Quality
- Agent 2: Storage Quality
- Agent 4: Core Infrastructure Quality

### Sprint 1.1b (Week 2)
- Agent 3: Authentication Quality
- Agent 6: Analytics Quality
- Agent 9: Configuration Quality

### Sprint 1.1c (Week 3)
- Agent 5: Social & Federation Quality
- Agent 7: UI Component Quality
- Agent 8: Durable Objects Quality

---

## Summary

| Agent | Area | Medium | Low | Est. Time |
|-------|------|--------|-----|-----------|
| 1 | Content | 4 | 4 | 3h |
| 2 | Storage | 5 | 2 | 3h |
| 3 | Authentication | 4 | 1 | 2h |
| 4 | Core Infrastructure | 4 | 2 | 2h |
| 5 | Social & Federation | 2 | 2 | 2h |
| 6 | Analytics | 4 | 1 | 2h |
| 7 | UI Components | 8 | 4 | 4h |
| 8 | Durable Objects | 1 | 2 | 1h |
| 9 | Configuration | 5 | 2 | 2h |
| **Total** | | **37** | **20** | **21h** |
